const db = require('../db'); // Assuming this is the database connection module

// Create the User table if it doesn't exist
const createTableQuery = `
  CREATE TABLE IF NOT EXISTS User (
    User_id INT AUTO_INCREMENT PRIMARY KEY,
    user_name VARCHAR(255) UNIQUE,
    password VARCHAR(255)
  );
`;

// Create the trigger
const createTriggerQuery = `
  DELIMITER //
  CREATE TRIGGER check_username
  BEFORE INSERT ON User
  FOR EACH ROW
  BEGIN
    DECLARE user_exists INT;

    SELECT 1 INTO user_exists
    FROM User
    WHERE user_name = NEW.user_name
    LIMIT 1;

    IF user_exists IS NOT NULL THEN
      SIGNAL SQLSTATE '45000'
      SET MESSAGE_TEXT = 'Username taken. Please choose a different username.';
    ELSE
      -- Assuming there's a password field in the User table
      INSERT INTO User (user_name, password)
      VALUES (NEW.user_name, NEW.password);
    END IF;
  END //
  DELIMITER ;
`;

// Function to initialize the database (create table and trigger)
const initializeDatabase = async () => {
  try {
    await db.query(createTableQuery);
    await db.query(createTriggerQuery);
    console.log('Database initialization successful');
  } catch (err) {
    console.error('Error initializing database:', err.message);
  }
};

// Call the function to initialize the database
initializeDatabase();

// ... Rest of your code, including userController and other routes
